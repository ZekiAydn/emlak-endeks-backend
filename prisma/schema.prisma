generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  fullName  String
  phone     String?
  email     String?
  about     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  media     Media[]  @relation("UserMedia")
  reports   Report[]
}

model Report {
  id                String           @id @default(cuid())
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  userId            String
  clientFullName    String
  addressText       String
  parcelText        String
  reportDate        DateTime
  consultantOpinion String?
  comparablesJson   Json?
  buildingDetails   BuildingDetails?
  media             Media[]          @relation("ReportMedia")
  pricingAnalysis   PricingAnalysis?
  propertyDetails   PropertyDetails?
  user              User             @relation(fields: [userId], references: [id])
}

model PropertyDetails {
  id         String  @id @default(cuid())
  reportId   String  @unique
  roomCount  Int?
  salonCount Int?
  bathCount  Int?
  grossArea  Float?
  netArea    Float?
  floor      Int?
  heating    String?
  facade     String?
  view       String?
  report     Report  @relation(fields: [reportId], references: [id])
}

model BuildingDetails {
  id                   String   @id @default(cuid())
  reportId             String   @unique
  buildingAge          Int?
  buildingFloors       Int?
  hasElevator          Boolean?
  isSite               Boolean?
  security             Boolean?
  buildingCondition    String?
  closedParking        Boolean?
  closedPool           Boolean?
  hasAC                Boolean?
  hasCaretaker         Boolean?
  hasChildrenPark      Boolean?
  hasFireplace         Boolean?
  hasGenerator         Boolean?
  hasSportsArea        Boolean?
  hasThermalInsulation Boolean?
  isOnMainRoad         Boolean?
  isOnStreet           Boolean?
  openParking          Boolean?
  openPool             Boolean?
  propertyType         String?
  report               Report   @relation(fields: [reportId], references: [id])
}

model PricingAnalysis {
  id                  String   @id @default(cuid())
  reportId            String   @unique
  minPrice            Float?
  expectedPrice       Float?
  maxPrice            Float?
  note                String?
  minPricePerSqm      Float?
  expectedPricePerSqm Float?
  maxPricePerSqm      Float?
  confidence          Float?
  aiJson              Json?
  createdAt           DateTime @default(now()) @db.Timestamptz(6)
  updatedAt           DateTime @default(now()) @db.Timestamptz(6)
  report              Report   @relation(fields: [reportId], references: [id])
}

model Media {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  type      MediaType
  mime      String
  filename  String?
  data      Bytes
  userId    String?
  reportId  String?
  order     Int       @default(0)
  report    Report?   @relation("ReportMedia", fields: [reportId], references: [id])
  user      User?     @relation("UserMedia", fields: [userId], references: [id])

  @@index([userId])
  @@index([reportId])
}

enum MediaType {
  USER_PHOTO
  CERTIFICATE
  REPORT_COVER
  MAP_IMAGE
  COMPS_SCREENSHOT
  CHARTS_SCREENSHOT
  OTHER
}
